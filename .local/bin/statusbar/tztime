#!/usr/bin/env bash
# Date and Time Block for i3blocks (i3status format)
set -euo pipefail

display_current_month_calendar() {
  cal -m -c1 -1
}

display_current_date_and_time() {
  date '+%d-%m-%Y %H:%M:%S'
}

handle_mouse_click_events() {
  if [[ -z "${BLOCK_BUTTON:-}" ]]; then
    return
  fi

  case $BLOCK_BUTTON in
    1)
      local calendar_output
      calendar_output=$(display_current_month_calendar)
      notify-send -i "text-vcalendar" "$(head -1 <<< "$calendar_output")" "$(tail -n +2 <<< "$calendar_output")"
      if command -v calcurse &>/dev/null; then
        local appointments
        appointments=$(calcurse -D ~/.config/calcurse -d3)
        notify-send -i "task-due" "Appointments" "$appointments"
      fi
      ;;
    2)
      setsid -f i3-sensible-terminal -e calcurse -D ~/.config/calcurse &
      ;;
    6)
      setsid -f i3-sensible-terminal -e "$EDITOR" "$0" &
      ;;
  esac
}

main() {
  display_current_date_and_time
  handle_mouse_click_events
}

main
