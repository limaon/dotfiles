#!/usr/bin/env bash
# i3blocks module - calendar/date
# Shows current date in "Feb 01 (Sat)" format
# Left click: current month calendar notification
set -euo pipefail

command -v notify-send >/dev/null 2>&1 || {
  echo "Error: 'notify-send' not found"
  exit 1
}

mark_weekend() {
  sed \
    -e 's|Su|<span color="red">&</span>|' \
    -e 's|Sa|<span color="lightblue">&</span>|'
}

mark_day() {
  sed \
    -e 's/..7m/<b><span color="white">/;' \
    -e 's/..0m/<\/span><\/b>/;'
}

show_cal() {
  cal -m --color=always | mark_weekend | mark_day
}

notify_calendar() {
  notify-send -r 9901 -i "office-calendar" -t 10 "<-=-=-=-=-=-=-=-=-=->" "$(show_cal)" &
}

# Handle click events
case ${BLOCK_BUTTON:-} in
  1) notify_calendar ;;
esac

# Output: full_text, short_text
date '+%b %d (%a)'
date '+%d.%m'
